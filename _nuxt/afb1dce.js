(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{349:function(e,t,n){"use strict";n.r(t);n(4),n(2),n(1),n(6),n(3),n(7),n(18),n(48),n(35),n(11),n(49),n(52),n(38);var o=n(17),r=n(0),c=(n(21),n(13),n(133),n(5),n(43),n(104)),l=n(67);function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw r}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v,y={name:"sync",data:function(){return{appDataFiles:[],loadingData:!1,uploadingData:!1}},computed:m(m({authenticated:function(){return this.$store.state.googlesync.alreadyUsed},tokenValid:function(){return this.$store.getters["googlesync/isValid"]}},Object(l.b)("theme",["primaryButtonVariant","elementVariant","isDark"])),{},{active:{get:function(){return this.$store.state.googlesync.active},set:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e){n.next=9;break}if(!1!==t.tokenValid){n.next=6;break}return n.next=4,c.a.refreshAccessToken(t.$store.state.googlesync.refreshToken);case 4:data=n.sent,t.$store.commit("googlesync/refreshAccessToken",data);case 6:c.a.loadRunningState(t.$store.state.googlesync.token,function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(n){var r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("There are "+n.files.length+" running states in gdrive"),!(n.files.length>0)){e.next=5;break}t.$bvModal.msgBoxConfirm("Auf diesem Account besteht bereits ein synchronisierter Fortschritt. Möchtest du Deinen synchronisierten Fortschritt mit dem lokalen überschreiben?",{title:"Achtung!",okVariant:"danger",okTitle:"Ja (löscht den alten Fortschritt auf GoogleDrive)",cancelTitle:"Nein (überschreibt den lokalen Fortschritt mit dem von GoogleDrive)",cancelVariant:"secondary",footerClass:"p-2",bodyBgVariant:t.elementVariant,footerBgVariant:t.elementVariant,headerBgVariant:t.elementVariant,hideHeaderClose:!1,centered:!0}).then(function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(o){var r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==o){e.next=12;break}return e.next=3,c.a.removeRunningState(t.$store.state.googlesync.token,n.files);case 3:return e.next=5,c.a.createExport(t.$localForage);case 5:return r=e.sent,e.next=8,c.a.createNewRunningState(t.$store.state.googlesync.token);case 8:l=e.sent,c.a.runningStateUpload(t.$store.state.googlesync.token,r,l.id,(function(data){t.$store.commit("googlesync/setFileId",data.id),t.$store.commit("googlesync/sync"),t.$store.commit("googlesync/setState",!0)})),e.next=13;break;case 12:!1===o&&c.a.loadAConfig(t.$store.state.googlesync.token,n.files[0].id,(function(data){t.$store.commit("googlesync/setFileId",n.files[0].id),t.$store.commit("googlesync/sync"),t.$store.commit("googlesync/setState",!0),t.useSave(data)}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){})),e.next=12;break;case 5:return e.next=7,c.a.createExport(t.$localForage);case 7:return r=e.sent,e.next=10,c.a.createNewRunningState(t.$store.state.googlesync.token);case 10:l=e.sent,c.a.runningStateUpload(t.$store.state.googlesync.token,r,l.id,(function(data){t.$store.commit("googlesync/setFileId",data.id),t.$store.commit("googlesync/sync"),t.$store.commit("googlesync/setState",!0)}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.next=10;break;case 9:t.$store.commit("googlesync/setState",e);case 10:case"end":return n.stop()}}),n)})))()}}}),beforeMount:function(){var e=this.$route,t=this.$store;void 0!==e.query.code&&!1===t.state.googlesync.alreadyUsed&&c.a.handleAccessToken(e.query.code,location.protocol+"//"+location.host+"/openfischer"+e.path,(function(e){console.log(e),t.commit("googlesync/login",e)}))},methods:{login:function(){c.a.forwardToLogin(location.protocol+"//"+location.host+"/openfischer"+this.$route.path)},logout:function(){this.$store.commit("googlesync/logout")},getData:(v=Object(o.a)(regeneratorRuntime.mark((function e(){var data,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this.tokenValid){e.next=5;break}return e.next=3,c.a.refreshAccessToken(this.$store.state.googlesync.refreshToken);case 3:data=e.sent,this.$store.commit("googlesync/refreshAccessToken",data);case 5:this.appDataFiles=[],this.loadingData=!0,c.a.loadConfig(this.$store.state.googlesync.token,(function(e){var n,o=d(e.files);try{var r=function(){var meta=n.value;c.a.loadAConfig(t.$store.state.googlesync.token,meta.id,(function(e){t.appDataFiles.push({id:meta.id,name:meta.name,data:e})}))};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}t.loadingData=!1}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)}),removeSave:function(e){var t=this;c.a.deleteAConfig(this.$store.state.googlesync.token,e,(function(n){var o=t.appDataFiles.map((function(e){return e.id})).indexOf(e);t.appDataFiles.splice(o,1)}))},upload:function(){var e=this;this.uploadingData=!0,c.a.createExport(this.$localForage).then((function(t){c.a.storeFile(e.$store.state.googlesync.token,"config.json",t,(function(t){e.uploadingData=!1}))}))},useSave:function(data){var e=this;this.$localForage.meta.clear().then((function(){e.$localForage.meta.setItem("EXAMS",data.exams),e.$localForage.meta.setItem("SETTINGS",data.settings),e.$localForage.nuxtLocalForage.clear().then((function(){for(var t=0,n=Object.keys(data.localQuestions);t<n.length;t++){var o=n[t];e.$localForage.nuxtLocalForage.setItem(o,data.localQuestions[o])}e.$store.dispatch("init",!0).then((function(){e.$router.push("/")}))}))}))}}},k=y,w=n(47),component=Object(w.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-row",{staticClass:"mb-4"},[n("b-col",[n("h4",[e._v("Datensicherung")]),e._v(" "),n("small",[n("p",[e._v("Diese Seite erlaubt es den lokal gespeicherten Fortschritt mit GoogleDrive abzugleichen. Dazu ist ein Google-Login notwendig.\n        Mit Hilfe der Sicherung kann der Fortschritt auf verschiedenen Geräten, z.B. dem Smartphone und dem PC,\n        und über verschiedene Browser synchronisiert werden.\n      Melde Dich mit deinem Google-Account an und bestätige den Zugriff. Mit den angefragten Berechtigungen können keine\n      andere Dateien von GoogleDrive gelesen oder verändert werden.")])]),e._v(" "),n("p",[e._v("\n        Nach der Anmeldung, gibt es zwei Möglichkeiten:\n      ")]),e._v(" "),n("p",[n("b",[e._v("Automatische Synchronisation")]),e._v(": Der Abgleich mit GoogleDrive funktioniert automatisch im Hintergrund. Am unteren\n        linken Bildschirmrand wird ein Symbol eingeblendet, welches den aktuellen Status dieses Abgleiches widerspiegelt.\n      ")]),e._v(" "),n("ul",[n("li",[n("font-awesome-icon",{attrs:{icon:["fa","circle-check"]}}),e._v(" Lokaler Fortschritt ist mit GoogleDrive abgeglichen.")],1),e._v(" "),n("li",[n("font-awesome-icon",{attrs:{icon:["fa","hourglass"]}}),e._v(" Lokaler Fortschritt weicht ab, wird innerhalb der nächsten Minute automatisch synchronisiert.")],1),e._v(" "),n("li",[n("font-awesome-icon",{attrs:{icon:["fa","rotate"]}}),e._v(" Upload der lokalen Daten läuft.")],1)]),e._v(" "),n("p",[n("b",[e._v("Manuelle Synchronisation")]),e._v(": Speicherstände können von Hand hoch- und heruntergeladen werden.")]),e._v(" "),n("b-alert",{attrs:{variant:"danger",show:""}},[e._v("Achtung: Das Herunterladen eines Speicherstandes löscht ALLE lokalen Daten und übernimmt die heruntergeladenen!")]),e._v(" "),e.authenticated?n("div",[n("p",[n("b",[e._v("Du bist angemeldet")]),e._v(" - Gültigkeit Access-Token: "+e._s(e.tokenValid))]),e._v(" "),n("b-button",{attrs:{block:"",variant:"secondary"},on:{click:e.logout}},[e._v("Abmelden")])],1):n("b-button",{attrs:{block:"",variant:e.primaryButtonVariant},on:{click:e.login}},[e._v("Login with Google")])],1)],1),e._v(" "),e.authenticated?[n("b-row",{staticClass:"mb-3"},[n("b-col",[n("b-form-checkbox",{attrs:{size:"lg",switch:""},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[e._v("Automatische Synchronisation")])],1)],1),e._v(" "),n("b-row",{staticClass:"mb-2"},[n("b-col",[n("b-button",{staticClass:"mb-2",attrs:{disabled:e.loadingData||e.active},on:{click:e.getData}},[e.loadingData?n("b-spinner",{attrs:{small:""}}):e._e(),e._v("\n          Liste verfügbare Daten von Drive ")],1)],1),e._v(" "),n("b-col",[n("b-button",{attrs:{disabled:e.uploadingData||e.active},on:{click:e.upload}},[e.uploadingData?n("b-spinner",{attrs:{small:""}}):e._e(),e._v(" Lokalen Stand hochladen")],1)],1)],1),e._v(" "),n("b-row",[n("b-col",e._l(e.appDataFiles,(function(t){return n("b-card",{key:t.id,staticClass:"mb-3",attrs:{"bg-variant":e.elementVariant},scopedSlots:e._u([{key:"header",fn:function(){return[n("h6",{staticClass:"mb-0 d-inline-flex"},[e._v(e._s(t.name)+" ("+e._s(new Date(t.data.time).toDateString())+")")]),e._v(" "),e.active?e._e():n("span",{staticClass:"float-right ml-3",on:{click:function(n){return e.removeSave(t.id)}}},[n("font-awesome-icon",{attrs:{role:"button",icon:["fa","trash-can"]}})],1),e._v(" "),e.active?e._e():n("span",{staticClass:"float-right ml-3",on:{click:function(n){return e.useSave(t.data)}}},[n("font-awesome-icon",{attrs:{role:"button",icon:["fa","download"]}})],1)]},proxy:!0}],null,!0)},[e._v(" "),n("b-card-text",[e._v("Beantwortete Fragen (richtig und falsch): "+e._s(Object.keys(t.data.localQuestions).length))])],1)})),1)],1)]:e._e()],2)}),[],!1,null,"61858890",null);t.default=component.exports}}]);